/* jQuery seeThru 0.9.7 - transparent HTML5 video - Copyright (c) 2012 Frederik Ring - for license, docs, et. al. see: see https://github.com/m90/jquery-seeThru */
(function(e){function t(t,n){var r=e("<canvas/>").attr({width:t.width,height:t.height}).get(0).getContext("2d");r.drawImage(n,0,0,t.width,t.height);var i=r.getImageData(0,0,t.width,t.height);for(var s=3,o=i.data.length;s<o;s+=4)i.data[s-1]=i.data[s-2]=i.data[s-3]=i.data[s],i.data[s]=255;return i}var n={init:function(n){n||(n={});var r=e.extend({fps:25,start:"autoplay",end:"loop",mask:"",alphaMask:!1,width:"",height:"",forceRendering:!1},n);return this.each(function(){e(this).data("seeThru")&&e.error("seeThru already initialized on selected element");var n=!1,i=r.alphaMask===!0,s=r.forceRendering===!0,o;e(r.mask).length&&(o=e(r.mask)[0],o.tagName==="IMG"?(e(o).hide(),n=!0):e.error("Mask element must be <img>")),this.tagName==="VIDEO"?(e(this).bind("loadedmetadata.seeThru",function(){function y(){var e=f.scrollTop(),t=e+f.height(),n=p.offset().top,r=n+p.height();return!(n<e&&r<e||n>t&&r>t)}function b(){var e=s?!0:y();if(e){v.drawImage(a,0,0,c.width,c.height*l);var t=v.getImageData(0,0,c.width,c.height),n=v.getImageData(0,c.height,c.width,c.height).data;for(var i=3,o=t.data.length;i<o;i+=4)t.data[i]=r.alphaMask?n[i-1]:Math.max(n[i-1],n[i-2],n[i-3]);d.putImageData(t,0,0,0,0,c.width,c.height)}}var u=e(this),a=this,f=e(window),l=n?1:2,c={width:~~r.width,height:~~r.height};if(!c.height||!c.width)!u.attr("width")&&!u.attr("height")?(c.width=c.width||a.videoWidth,c.height=c.height||a.videoHeight/l):u.attr("height")?u.attr("width")?(c.width=c.width||~~a.width,c.height=c.height||~~a.height/l):(c.width=c.width||~~a.height*(a.videoWidth/Math.floor(a.videoHeight/l)),c.height=c.height||~~a.height):(c.width=c.width||~~a.width,c.height=c.height||~~a.width/(a.videoWidth/Math.floor(a.videoHeight/l)));var h=e("<canvas/>",{"class":"seeThru-buffer"}).attr({width:c.width,height:c.height*2}).hide(),p=e("<canvas/>",{"class":"seeThru-display"}).attr({width:c.width,height:c.height}),d=p[0].getContext("2d"),v=h[0].getContext("2d");p.bind("mouseenter mouseleave click mousedown mouseup mousemove mouseover hover dblclick contextmenu focus blur",function(e){u.trigger(e)}),n&&(o.width=c.width,o.height=c.height,i?v.putImageData(t(c,o),0,c.height):v.drawImage(o,0,c.height,c.width,c.height));var m,g=1/r.fps*1e3;u.hide().data("seeThru",{staticMask:n,alphaMask:i,interval:m}).after(h,p),u.bind("play.seeThru",function(){clearInterval(m),m=setInterval(b,g),u.data("seeThru").interval=m}).bind("pause.seeThru",function(){clearInterval(m)}),r.start==="autoplay"?u.trigger("play.seeThru"):r.start==="clicktoplay"?(a.play(),a.pause(),b(),p.one("click.seeThru",function(){a.play()})):r.start==="external"?(a.play(),a.pause(),u.bind("timeupdate.seeThru",function(){b()})):a.play(),r.end==="loop"?u.bind("ended.seeThru",function(){a.play()}):r.end==="rewind"?u.bind("ended.seeThru",function(){a.pause(),a.currentTime=0,r.start=="clicktoplay"&&p.one("click.seeThru",function(){a.play()})}):u.bind("ended.seeThru",function(){a.pause(),r.start=="clicktoplay"&&p.one("click.seeThru",function(){a.play()})})}),this.videoWidth&&this.videoHeight&&e(this).trigger("loadedmetadata.seeThru")):e.error("Selected element must be <video> element")})},updateMask:function(n){var r=e.extend({mask:""},n);return this.each(function(){var n=e(this);if(e(r.mask).length){var i=n.data("seeThru").staticMask,s=n.data("seeThru").alphaMask;if(i)if(e(r.mask)[0].tagName==="IMG"){var o={width:n.width(),height:n.height()},u=e(r.mask)[0];u.width=o.width,u.height=o.height;var a=n.nextAll(".seeThru-buffer")[0].getContext("2d");s?a.putImageData(t(o,u),0,o.height):a.drawImage(u,0,o.height,o.width,o.height)}else e.error("Passed mask element must be <img>");else e.error("Cannot apply method '.updateMask()' to element with moving alpha")}else e.error("Missing parameter 'mask'")})},revert:function(){return this.each(function(){var t=e(this);t.data("seeThru")&&(clearInterval(t.data("seeThru").interval),t.show().unbind(".seeThru").removeData("seeThru").nextAll(".seeThru-buffer:first, .seeThru-display:first").remove())})},play:function(){return this.each(function(){e(this).data("seeThru")&&this.play()})},pause:function(){return this.each(function(){e(this).data("seeThru")&&this.pause()})},rewind:function(){return this.each(function(){e(this).data("seeThru")&&(this.pause(),this.currentTime=0)})}};e.fn.seeThru=function(t){if(n[t])return n[t].apply(this,Array.prototype.slice.call(arguments,1));if(typeof t=="object"||!t)return n.init.apply(this,arguments);e.error("Method "+t+" does not exist on jQuery.seeThru")}})(jQuery)