/* jQuery seeThru 0.9.7 - transparent HTML5 video - Copyright (c) 2012 Frederik Ring - for license, docs, et. al. see: see https://github.com/m90/jquery-seeThru */
(function(e){function t(t,n){var r=e("<canvas/>").attr({width:t.width,height:t.height}).get(0).getContext("2d");r.drawImage(n,0,0,t.width,t.height);var i=r.getImageData(0,0,t.width,t.height);for(var s=3,o=i.data.length;s<o;s+=4)i.data[s-1]=i.data[s-2]=i.data[s-3]=i.data[s],i.data[s]=255;return i}var n={init:function(n){n||(n={});var r=e.extend({fps:25,start:"autoplay",end:"loop",mask:"",alphaMask:!1,width:"",height:"",forceRendering:!1},n);return this.each(function(){e(this).data("seeThru")&&e.error("seeThru already initialized on selected element");var n=!1,i=r.alphaMask===!0,s=r.forceRendering===!0,o;e(r.mask).length&&(o=e(r.mask)[0],o.tagName==="IMG"?(e(o).hide(),n=!0):e.error("Mask element must be <img>")),this.tagName==="VIDEO"?(e(this).bind("loadedmetadata.seeThru",function(){function b(){var e=f.scrollTop(),t=e+f.height(),n=d.offset().top,r=n+d.height();return!(n<e&&r<e||n>t&&r>t)}function w(){var e=s?!0:b();if(e){m.drawImage(a,0,0,c.width,c.height*l);var t=m.getImageData(0,0,c.width,c.height),n=m.getImageData(0,c.height,c.width,c.height).data;for(var r=3,i=t.data.length;r<i;r+=4)t.data[r]=Math.floor((n[r-1]+n[r-2]+n[r-3])/3);v.putImageData(t,0,0,0,0,c.width,c.height)}}var u=e(this),a=this,f=e(window),l=n?1:2,c={width:parseInt(r.width,10),height:parseInt(r.height,10)};if(!c.height||!c.width)if(!u.attr("width")&&!u.attr("height"))c.width=c.width||a.videoWidth,c.height=c.height||a.videoHeight/l;else if(!u.attr("height")){var h=a.videoWidth/Math.floor(a.videoHeight/l);c.width=c.width||parseInt(u.attr("width"),10),c.height=c.height||parseInt(u.attr("width")/h,10)}else if(!u.attr("width")){var h=a.videoWidth/Math.floor(a.videoHeight/l);c.width=c.width||parseInt(u.attr("height"),10)*h,c.height=c.height||parseInt(u.attr("height"),10)}else c.width=c.width||parseInt(u.attr("width"),10),c.height=c.height||parseInt(u.attr("height"),10)/l;var p=e("<canvas/>",{"class":"seeThru-buffer"}).attr({width:c.width,height:c.height*2}).hide(),d=e("<canvas/>",{"class":"seeThru-display"}).attr({width:c.width,height:c.height}),v=d[0].getContext("2d"),m=p[0].getContext("2d");d.bind("mouseenter mouseleave click mousedown mouseup mousemove mouseover hover dblclick contextmenu focus blur",function(e){u.trigger(e)}),n&&(o.width=c.width,o.height=c.height,i?m.putImageData(t(c,o),0,c.height):m.drawImage(o,0,c.height,c.width,c.height));var g,y=1/r.fps*1e3;u.hide().data("seeThru",{staticMask:n,alphaMask:i,interval:g}).after(p,d),u.bind("play.seeThru",function(){clearInterval(g),g=setInterval(w,y),u.data("seeThru").interval=g}).bind("pause.seeThru",function(){clearInterval(g)}),r.start==="autoplay"?u.trigger("play.seeThru"):r.start==="clicktoplay"?(a.play(),a.pause(),w(),d.one("click.seeThru",function(){a.play()})):r.start==="external"?(a.play(),a.pause(),u.bind("timeupdate.seeThru",function(){w()})):a.play(),r.end==="loop"?u.bind("ended.seeThru",function(){a.play()}):r.end==="rewind"?u.bind("ended.seeThru",function(){a.pause(),a.currentTime=0,r.start=="clicktoplay"&&d.one("click.seeThru",function(){a.play()})}):u.bind("ended.seeThru",function(){a.pause(),r.start=="clicktoplay"&&d.one("click.seeThru",function(){a.play()})})}),this.videoWidth&&this.videoHeight&&e(this).trigger("loadedmetadata.seeThru")):e.error("Selected element must be <video> element")})},updateMask:function(n){var r=e.extend({mask:""},n);return this.each(function(){var n=e(this);if(e(r.mask).length){var i=n.data("seeThru").staticMask,s=n.data("seeThru").alphaMask;if(i)if(e(r.mask)[0].tagName==="IMG"){var o={width:n.width(),height:n.height()},u=e(r.mask)[0];u.width=o.width,u.height=o.height;var a=n.nextAll(".seeThru-buffer")[0].getContext("2d");s?a.putImageData(t(o,u),0,o.height):a.drawImage(u,0,o.height,o.width,o.height)}else e.error("Passed mask element must be <img>");else e.error("Cannot apply method '.updateMask()' to element with moving alpha")}else e.error("Missing parameter 'mask'")})},revert:function(){return this.each(function(){var t=e(this);t.data("seeThru")&&(clearInterval(t.data("seeThru").interval),t.show().unbind(".seeThru").removeData("seeThru").nextAll(".seeThru-buffer:first,.seeThru-display:first").remove())})},play:function(){return this.each(function(){e(this).data("seeThru")&&this.play()})},pause:function(){return this.each(function(){e(this).data("seeThru")&&this.pause()})},rewind:function(){return this.each(function(){e(this).data("seeThru")&&(this.pause(),this.currentTime=0)})}};e.fn.seeThru=function(t){if(n[t])return n[t].apply(this,Array.prototype.slice.call(arguments,1));if(typeof t=="object"||!t)return n.init.apply(this,arguments);e.error("Method "+t+" does not exist on jQuery.seeThru")}})(jQuery)