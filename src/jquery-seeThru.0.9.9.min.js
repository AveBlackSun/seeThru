/* jQuery seeThru 0.9.9 - transparent HTML5 video - Copyright (c) 2012 Frederik Ring - for license, docs, et. al. see: see https://github.com/m90/jquery-seeThru */
(function(a){function b(b,c){var d=a("<canvas/>").attr({width:b.width,height:b.height}).get(0).getContext("2d");d.drawImage(c,0,0,b.width,b.height);for(var e=d.getImageData(0,0,b.width,b.height),f=3,g=e.data.length;g>f;f+=4)e.data[f-1]=e.data[f-2]=e.data[f-3]=e.data[f],e.data[f]=255;return e}(function(){for(var a=0,b=["ms","moz","webkit","o"],c=0;b.length>c&&!window.requestAnimationFrame;++c)window.requestAnimationFrame=window[b[c]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[b[c]+"CancelAnimationFrame"]||window[b[c]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(b){var d=(new Date).getTime(),e=Math.max(0,16-(d-a)),f=window.setTimeout(function(){b(d+e)},e);return a=d+e,f}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(a){clearTimeout(a)})})();var c={init:function(c){c||(c={});var d=a.extend({start:"autoplay",end:"loop",mask:"",alphaMask:!1,width:"",height:""},c);return this.each(function(){a(this).data("seeThru")&&a.error("seeThru already initialized on selected element");var f,c=!1,e=d.alphaMask===!0;a(d.mask).length&&(f=a(d.mask)[0],"IMG"===f.tagName?(a(f).hide(),c=!0):a.error("Mask element must be <img>")),"VIDEO"===this.tagName?(a(this).bind("loadedmetadata.seeThru",function(){function q(a){o.drawImage(h,0,0,k.width,k.height*j);for(var b=o.getImageData(0,0,k.width,k.height),c=o.getImageData(0,k.height,k.width,k.height).data,e=3,f=b.data.length;f>e;e+=4)b.data[e]=d.alphaMask?c[e-1]:Math.max(c[e-1],c[e-2],c[e-3]);n.putImageData(b,0,0,0,0,k.width,k.height),a&&(p=requestAnimationFrame(function(){q(!0)}))}var g=a(this),h=this,j=(a(window),c?1:2),k={width:~~d.width,height:~~d.height};k.height&&k.width||(g.attr("width")||g.attr("height")?g.attr("height")?g.attr("width")?(k.width=k.width||~~h.width,k.height=k.height||~~h.height/j):(k.width=k.width||~~h.height*(h.videoWidth/Math.floor(h.videoHeight/j)),k.height=k.height||~~h.height):(k.width=k.width||~~h.width,k.height=k.height||~~h.width/(h.videoWidth/Math.floor(h.videoHeight/j))):(k.width=k.width||h.videoWidth,k.height=k.height||h.videoHeight/j));var l=a("<canvas/>",{"class":"seeThru-buffer"}).attr({width:k.width,height:2*k.height}).hide(),m=a("<canvas/>",{"class":"seeThru-display"}).attr({width:k.width,height:k.height}),n=m[0].getContext("2d"),o=l[0].getContext("2d");m.bind("mouseenter mouseleave click mousedown mouseup mousemove mouseover hover dblclick contextmenu focus blur",function(a){g.trigger(a)}),c&&(f.width=k.width,f.height=k.height,e?o.putImageData(b(k,f),0,k.height):o.drawImage(f,0,k.height,k.width,k.height)),"stop"===d.end&&h.loop&&(h.loop=!1);var p;g.hide().data("seeThru",{staticMask:c,alphaMask:e,interval:p}).after(l,m),g.bind("play.seeThru",function(){cancelAnimationFrame(p),p=requestAnimationFrame(function(){q(!0)}),g.data("seeThru").interval=p}).bind("pause.seeThru",function(){cancelAnimationFrame(p)}),"autoplay"===d.start?g.trigger("play.seeThru"):"clicktoplay"===d.start?(h.play(),h.pause(),q(),m.one("click.seeThru",function(){h.play()})):"external"===d.start?(h.play(),h.pause(),g.bind("timeupdate.seeThru",function(){q()})):h.play(),"loop"===d.end?g.bind("ended.seeThru",function(){h.play()}):"rewind"===d.end?g.bind("ended.seeThru",function(){h.pause(),h.currentTime=0,"clicktoplay"==d.start&&m.one("click.seeThru",function(){h.play()})}):g.bind("ended.seeThru",function(){h.pause(),"clicktoplay"==d.start&&m.one("click.seeThru",function(){h.play()})})}),this.videoWidth&&this.videoHeight&&a(this).trigger("loadedmetadata.seeThru")):a.error("Selected element must be <video> element")})},updateMask:function(c){var d=a.extend({mask:""},c);return this.each(function(){var c=a(this);if(a(d.mask).length){var e=c.data("seeThru").staticMask,f=c.data("seeThru").alphaMask;if(e)if("IMG"===a(d.mask)[0].tagName){var g={width:c.width(),height:c.height()},h=a(d.mask)[0];h.width=g.width,h.height=g.height;var i=c.nextAll(".seeThru-buffer")[0].getContext("2d");f?i.putImageData(b(g,h),0,g.height):i.drawImage(h,0,g.height,g.width,g.height)}else a.error("Passed mask element must be <img>");else a.error("Cannot apply method '.updateMask()' to element with moving alpha")}else a.error("Missing parameter 'mask'")})},revert:function(){return this.each(function(){var b=a(this);b.data("seeThru")&&(cancelAnimationFrame(b.data("seeThru").interval),b.show().unbind(".seeThru").removeData("seeThru").nextAll(".seeThru-buffer:first, .seeThru-display:first").remove())})},play:function(){return this.each(function(){a(this).data("seeThru")&&this.play()})},pause:function(){return this.each(function(){a(this).data("seeThru")&&this.pause()})},rewind:function(){return this.each(function(){a(this).data("seeThru")&&(this.pause(),this.currentTime=0)})}};a.fn.seeThru=function(b){return c[b]?c[b].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof b&&b?(a.error("Method "+b+" does not exist on jQuery.seeThru"),void 0):c.init.apply(this,arguments)}})(jQuery);