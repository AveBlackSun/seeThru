/*! jquery-seethru 2.0.0 29-08-2014 see https://github.com/m90/jquery-seeThru for details */
!function(a,b){"function"==typeof define&&define.amd?define(b):"object"==typeof exports?module.exports=b():a.seeThru=b()}(this,function(){function a(a){var b,c=document.createElement("canvas"),d=c.getContext("2d");c.width=a.width,c.height=a.height,b=d.getImageData(0,0,a.width,a.height);for(var e=3,f=b.data.length;f>e;e+=4)b.data[e-1]=b.data[e-2]=b.data[e-3]=b.data[e],b.data[e]=255;return b}function b(a,b){for(var c=3,d=a.data.length;d>c;c+=4)a.data[c]=b[c-1],a.data[c-3]=a.data[c-3]/(b[c-1]?b[c-1]/255:1),a.data[c-2]=a.data[c-2]/(b[c-1]?b[c-1]/255:1),a.data[c-1]=a.data[c-1]/(b[c-1]?b[c-1]/255:1);return a}function c(){for(var a=0,b=["ms","moz","webkit","o"],c=0;c<b.length&&!window.requestAnimationFrame;++c)window.requestAnimationFrame=window[b[c]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[b[c]+"CancelAnimationFrame"]||window[b[c]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(b){var c=(new Date).getTime(),d=Math.max(0,16-(c-a)),e=window.setTimeout(function(){b(c+d)},d);return a=c+d,e}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(a){clearTimeout(a)})}function d(a){return[].slice.call(a)}function e(a){return Object.prototype.toString.call(a)}function f(a,b){b.nextSibling?b.parentNode.insertBefore(a,b.nextSibling):b.parentNode.appendChild(a)}function g(a){return a.tagName?a:"[object String]"===e(a)?document.querySelector(a):a.length?a[0]:null}function h(a){a=a||window.jQuery,a.fn.seeThru=function(){var b=d(arguments);return this.each(function(){if(!b.length||1===b.length&&"[object Object]"===e(b[0])){if(a(this).data("seeThru"))return;a(this).data("seeThru",new j(this,b[0]).init())}else if(b.length&&"[object String]"===e(b[0])){if(!a(this).data("seeThru"))return;a(this).data("seeThru")[b[0]](b[1]),"revert"===b[0]&&a(this).data("seeThru",null)}})}}function i(c,d){var e,h,i,j,k=!1,l=this,m=d.staticMask?1:2,n={width:parseInt(d.width,10),height:parseInt(d.height,10)},o=document.createElement("canvas"),p=o.getContext("2d"),q=document.createElement("canvas"),r=q.getContext("2d"),s=function(a){var e,f,g,h;if(k){for(p.drawImage(c,0,0,n.width,n.height*m),e=p.getImageData(0,0,n.width,n.height),f=p.getImageData(0,n.height,n.width,n.height).data,d.unmult&&b(e,f),g=3,h=e.data.length;h>g;g+=4)e.data[g]=d.alphaMask?f[g-1]:Math.max(f[g-1],f[g-2],f[g-3]);r.putImageData(e,0,0,0,0,n.width,n.height)}a&&(i=requestAnimationFrame(function(){s(!0)}))};this.init=function(){var b=c.getBoundingClientRect();if(n.height&&n.width||(c.width&&!c.height?(n.width=n.width||c.videoWidth,n.height=n.height||c.videoHeight/m):c.height?(n.width=n.width||parseInt(b.width,10),n.height=n.height||parseInt(b.width,10)/(c.videoWidth/Math.floor(c.videoHeight/m))):c.width?(n.width=n.width||parseInt(b.height,10)*(c.videoWidth/Math.floor(c.videoHeight/m)),n.height=n.height||parseInt(b.height,10)):(n.width=n.width||parseInt(b.width,10),n.height=n.height||parseInt(b.height,10)/m)),o.width=n.width,o.height=2*n.height,o.style.display="none",o.className="seeThru-buffer",q.width=n.width,q.height=n.height,q.className="seeThru-display",f(o,c),f(q,c),d.staticMask){if(j=g(d.staticMask),"IMG"!==j.tagName)throw new Error("Cannot use non-image element as mask!");j.width=n.width,j.height=n.height,d.alphaMask?p.putImageData(a(n,j),0,n.height):p.drawImage(j,0,n.height,n.width,n.height),j.style.display="none"}d.poster&&c.poster&&(h=document.createElement("div"),h.className="seeThru-poster",h.style.width=n.width+"px",h.style.height=n.height+"px",h.style.position="absolute",h.style.top=0,h.style.left=0,h.style.backgroundSize="cover",h.style.backgroundPosition="center",h.style.backgroundImage='url("'+c.poster+'")',f(h,c)),e=window.getComputedStyle(c).display,c.style.display="none","autoplay"===d.start&&c.play(),k=!0},this.startRendering=function(){return s(!0),this},this.stopRendering=function(){return cancelAnimationFrame(i),this},this.teardown=function(){return cancelAnimationFrame(i),c.nextSibling.remove(),c.nextSibling.remove(),c.style.display=e,this},this.getCanvas=function(){return q},this.getPoster=function(){return h},c.readyState>0?this.init():c.addEventListener("loadedmetadata",function(){l.init()})}function j(a,b){var d=this,e={start:"autoplay",end:"loop",mask:!1,alphaMask:!1,width:null,height:null,poster:!1,unmult:!1,shimRAF:!0};if(b=b||{},this._video=g(a),!this._video||"VIDEO"!==this._video.tagName)throw new Error("Could not use specified source");this._options=function(a){for(var b in e)b in a||(a[b]=e[b]);return a}(b),this.init=function(){function a(){d._video.play(),d._options.poster?d._seeThru.getPoster().removeEventListener("click",a):d._seeThru.getCanvas().removeEventListener("click",a)}return!this._options.shimRAF||window.requestAnimationFrame&&window.cancelAnimationFrame||c(),this._seeThru=new i(this._video,this._options),"clicktoplay"===this._options.start?this._options.poster?this._seeThru.getPoster().addEventListener("click",a):this._seeThru.getCanvas().addEventListener("click",a):"autoplay"===this._options.start&&b.poster&&(this._seeThru.getPoster().style.display="none"),"rewind"===this._options.end?this._video.addEventListener("ended",function(){d._video.currentTime=0,d._seeThru.getCanvas().addEventListener("click",a)}):"stop"!==this._options.end&&this._video.addEventListener("ended",function(){d._video.currentTime=0,d._video.play()}),this._options.poster&&this._video.poster&&(this._video.addEventListener("play",function(){d._seeThru.getPoster().style.display="none"}),this._video.addEventListener("pause",function(){d._seeThru.getPoster().style.display="block"})),this._seeThru.startRendering(),this},this.play=function(){return this._video.play(),this},this.pause=function(){return this._video.pause(),this},this.revert=function(){this._seeThru.teardown()},this.updateMask=function(a){this._seeThru.updateMask(a)}}return window.jQuery&&h(window.jQuery),{create:function(a,b){return new j(a,b).init()},attach:h}});